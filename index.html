<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>キーボードで遊ぶミニマリオ</title>
  <style>
    :root {
      font-family: "Noto Sans JP", system-ui, sans-serif;
      background-color: #030617;
      color: #fff;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(180deg, #5ec2ff, #0d1b56 70%);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem 1rem;
    }
    .game-shell {
      width: min(1000px, 100%);
      border-radius: 2rem;
      background: rgba(3, 6, 20, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 2rem;
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.5);
    }
    header {
      text-align: center;
      margin-bottom: 1rem;
    }
    header h1 {
      margin: 0;
      font-size: clamp(2.5rem, 4vw, 3.5rem);
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }
    header p {
      margin: 0.5rem auto 0;
      color: #a7c6ff;
      font-size: 1.05rem;
    }
    canvas {
      display: block;
      width: 100%;
      border-radius: 1.5rem;
      background: linear-gradient(#4fc3ff, #1a5bb8);
      box-shadow: inset 0 0 55px rgba(255, 255, 255, 0.08), 0 15px 30px rgba(0, 0, 0, 0.5);
    }
    .info {
      margin-top: 1rem;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .info div {
      background: rgba(255, 255, 255, 0.02);
      padding: 0.75rem 1rem;
      border-radius: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.12);
      min-width: 220px;
    }
    .info strong {
      display: block;
      font-size: 0.8rem;
      letter-spacing: 0.15em;
      color: #7ecbff;
      margin-bottom: 0.35rem;
    }
    .info span {
      font-size: 1.25rem;
      display: block;
    }
  </style>
</head>
<body>
  <div class="game-shell">
    <header>
      <h1>ミニマリオ風ランナー</h1>
      <p>←→で左右、↑でジャンプ。ゴールを目指してみよう！</p>
    </header>
    <canvas id="game" width="900" height="500" aria-label="キーボード操作で動かすプラットフォーマーゲーム"></canvas>
    <div class="info">
      <div>
        <strong>操作</strong>
        <span>左右キー / ジャンプ（↑またはスペース）</span>
      </div>
      <div>
        <strong>ゴール距離</strong>
        <span id="progress">0%</span>
      </div>
    </div>
  </div>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const width = canvas.width;
    const height = canvas.height;

    const hero = {
      x: 60,
      y: 0,
      width: 36,
      height: 48,
      vx: 0,
      vy: 0,
      color: "#ffbb3f",
      grounded: false,
    };

    const gravity = 0.9;
    const friction = 0.85;

    const platforms = [
      { x: 0, y: height - 30, width, height: 30 },
      { x: 160, y: height - 120, width: 160, height: 16 },
      { x: 360, y: height - 200, width: 200, height: 16 },
      { x: 600, y: height - 140, width: 140, height: 16 },
      { x: 780, y: height - 80, width: 140, height: 16 },
    ];

    const enemyPlatform = platforms[2];
    const enemy = {
      width: 32,
      height: 32,
      x: enemyPlatform.x + 24,
      y: enemyPlatform.y - 32,
      vx: 2.2,
      patrolStart: enemyPlatform.x + 10,
      patrolEnd: enemyPlatform.x + enemyPlatform.width - 32 - 10,
      color: "#ff4d6d",
    };

    let hitMessageTimer = 0;
    const hitMessageDuration = 60;

    const goalLine = width - 60;

    const keys = {
      ArrowLeft: false,
      ArrowRight: false,
      ArrowUp: false,
      Space: false,
    };

    function drawBackground() {
      const grd = ctx.createLinearGradient(0, 0, 0, height);
      grd.addColorStop(0, "#74c0f0");
      grd.addColorStop(1, "#1b3f8f");
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, width, height);
      for (let i = 0; i < 10; i++) {
        ctx.fillStyle = "rgba(255,255,255,0.08)";
        ctx.beginPath();
        ctx.arc(120 * i, 80, 12, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function drawSunset() {
      const grd = ctx.createRadialGradient(120, 80, 20, 120, 80, 90);
      grd.addColorStop(0, "#ffe066");
      grd.addColorStop(1, "rgba(255, 224, 102, 0)");
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, width, height);
    }

    function drawEnemy() {
      ctx.fillStyle = enemy.color;
      ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
      ctx.fillStyle = "#fff";
      ctx.fillRect(enemy.x + 6, enemy.y + 6, 6, 6);
      ctx.fillRect(enemy.x + enemy.width - 12, enemy.y + 6, 6, 6);
    }

    const heroSpawn = { x: hero.x, y: hero.y };

    function respawnHero() {
      hero.x = heroSpawn.x;
      hero.y = heroSpawn.y;
      hero.vx = 0;
      hero.vy = 0;
      hero.grounded = false;
    }

    function updateEnemy() {
      enemy.x += enemy.vx;
      if (enemy.x <= enemy.patrolStart || enemy.x + enemy.width >= enemy.patrolEnd) {
        enemy.vx *= -1;
      }
    }

    function checkEnemyCollision() {
      if (
        hero.x + hero.width > enemy.x &&
        hero.x < enemy.x + enemy.width &&
        hero.y + hero.height > enemy.y &&
        hero.y < enemy.y + enemy.height
      ) {
        respawnHero();
        hitMessageTimer = hitMessageDuration;
      }
    }

    function drawHitMessage() {
      if (hitMessageTimer > 0) {
        ctx.font = "bold 26px sans-serif";
        ctx.textAlign = "center";
        ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
        ctx.fillText("ENEMY HIT!", width / 2, 48);
        hitMessageTimer -= 1;
      }
    }

    function drawPlatforms() {
      platforms.forEach((plat) => {
        const gradient = ctx.createLinearGradient(plat.x, plat.y, plat.x, plat.y + plat.height);
        gradient.addColorStop(0, "#ffd166");
        gradient.addColorStop(1, "#f3841d");
        ctx.fillStyle = gradient;
        ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
        ctx.strokeStyle = "#f6b05b";
        ctx.lineWidth = 2;
        ctx.strokeRect(plat.x, plat.y, plat.width, plat.height);
      });

      ctx.fillStyle = "#fff";
      ctx.fillRect(goalLine + 40, height - 180, 6, 140);
      ctx.fillStyle = "#ff4b5c";
      ctx.beginPath();
      ctx.moveTo(goalLine + 46, height - 180);
      ctx.lineTo(goalLine + 46 + 30, height - 160);
      ctx.lineTo(goalLine + 46, height - 140);
      ctx.fill();
    }

    function handleInput() {
      if (keys.ArrowLeft) {
        hero.vx = Math.max(hero.vx - 0.9, -6);
      } else if (keys.ArrowRight) {
        hero.vx = Math.min(hero.vx + 0.9, 6);
      } else {
        hero.vx *= friction;
      }
      if (keys.ArrowUp || keys.Space) {
        if (hero.grounded) {
          hero.vy = -16;
          hero.grounded = false;
        }
      }
    }

    function applyPhysics() {
      hero.vy += gravity;
      hero.x += hero.vx;
      hero.y += hero.vy;

      if (hero.x < 0) {
        hero.x = 0;
        hero.vx = 0;
      } else if (hero.x + hero.width > width) {
        hero.x = width - hero.width;
        hero.vx = 0;
      }

      hero.grounded = false;
      platforms.forEach((plat) => {
        if (
          hero.x + hero.width > plat.x &&
          hero.x < plat.x + plat.width &&
          hero.y + hero.height > plat.y &&
          hero.y + hero.height < plat.y + plat.height + hero.vy &&
          hero.vy >= 0
        ) {
          hero.y = plat.y - hero.height;
          hero.vy = 0;
          hero.grounded = true;
        }
      });

      if (hero.y + hero.height > height) {
        hero.y = height - hero.height;
        hero.vy = 0;
        hero.grounded = true;
      }
    }

    function drawHero() {
      ctx.fillStyle = hero.color;
      ctx.fillRect(hero.x, hero.y, hero.width, hero.height);
      ctx.fillStyle = "#000";
      ctx.fillRect(hero.x + 6, hero.y + 10, 8, 8);
      ctx.fillRect(hero.x + hero.width - 14, hero.y + 10, 8, 8);
    }

    function drawProgress() {
      const progress = Math.min(100, Math.max(0, Math.round((hero.x / (goalLine - hero.width)) * 100)));
      document.getElementById("progress").textContent = `${progress}%`;
    }

    function checkGoal() {
      if (hero.x + hero.width >= goalLine) {
        ctx.font = "bold 36px sans-serif";
        ctx.fillStyle = "#fff";
        ctx.fillText("GOAL!", width / 2 - 80, 60);
      }
    }

    function loop() {
      drawBackground();
      drawSunset();
      drawPlatforms();
      updateEnemy();
      drawEnemy();
      handleInput();
      applyPhysics();
      checkEnemyCollision();
      drawHero();
      drawProgress();
      checkGoal();
      drawHitMessage();
      requestAnimationFrame(loop);
    }

    window.addEventListener("keydown", (event) => {
      const key = event.code;
      if (key === "Space") {
        keys.Space = true;
      }
      if (key === "ArrowUp") {
        keys.ArrowUp = true;
      }
      if (key === "ArrowLeft") {
        keys.ArrowLeft = true;
      }
      if (key === "ArrowRight") {
        keys.ArrowRight = true;
      }
    });

    window.addEventListener("keyup", (event) => {
      const key = event.code;
      if (key === "Space") {
        keys.Space = false;
      }
      if (key === "ArrowUp") {
        keys.ArrowUp = false;
      }
      if (key === "ArrowLeft") {
        keys.ArrowLeft = false;
      }
      if (key === "ArrowRight") {
        keys.ArrowRight = false;
      }
    });

    loop();
  </script>
</body>
</html>
